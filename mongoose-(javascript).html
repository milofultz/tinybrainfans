<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="description" content="Mongoose is an NPM package that allows a simple and schema'd Javascript entrypoint to your Mongo database."><title>Mongoose (Javascript)</title><link rel="stylesheet" href="./styles.css"></head><body>
<main id="main"><article id="content">            <h1 id="title">Mongoose (Javascript)</h1>
            <p>Mongoose is an <a href="npm.html">NPM</a> package that allows a simple and schema'd <a href="javascript.html">Javascript</a> entrypoint to your <a href="mongodb.html">Mongo database</a>.</p>
<h2>Basics</h2>
<h3>Setup</h3>
<p>Install mongoose: <code>npm i mongoose</code> and ensure your <a href="database.html">database</a> is running.</p>
<h3>Project</h3>
<p>Create a new file called <code>server.js</code> and put this within.</p>
<div class="highlight"><pre><span></span><span class="c1">// Initilize database</span>

<span class="kd">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;mongoose&quot;</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">dbName</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">;</span>
<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="sb">`mongodb://localhost:27017/</span><span class="si">${</span><span class="nx">dbName</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">useNewUrlParser</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// Create test schema</span>

<span class="kd">const</span> <span class="nx">testSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span>
  <span class="nx">friends</span><span class="o">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">],</span>
<span class="p">});</span>

<span class="c1">// Create a model from your schema</span>

<span class="c1">// this first param is the name of your collection in your test database</span>
<span class="kd">const</span> <span class="nx">Test</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="nx">testSchema</span><span class="p">);</span>

<span class="c1">// Connect to database</span>

<span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">connection</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="s2">&quot;connection error:&quot;</span><span class="p">));</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Mongoose DB &quot;</span><span class="si">${</span><span class="nx">dbName</span><span class="si">}</span><span class="sb">&quot; initialized\n`</span><span class="p">)</span>
<span class="p">});</span>
</pre></div>
<p>This will have created your basics. You can now start creating queries, inserting items into your database, etc.</p>
<h2>Schemas and Models</h2>
<p>Basic schemas are written very simply using a standard JSON format.</p>
<p>The following schema is for a registration form. It has five fields, all with differing implementations. Most basic, you can just put the key followed by it's type. If you want extended functionality, you can utilize it by using object notation.</p>
<div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">attendeeSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
  <span class="nx">firstName</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">lastName</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">email</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">match</span><span class="o">:</span> <span class="sr">/[a-z0-9!#$%&amp;&#39;*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&amp;&#39;*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">shirt</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;XS&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;XL&#39;</span><span class="p">,</span> <span class="s1">&#39;XXL&#39;</span><span class="p">],</span>
    <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">skillLevel</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;beginner&#39;</span><span class="p">,</span> <span class="s1">&#39;intermediate&#39;</span><span class="p">,</span> <span class="s1">&#39;expert&#39;</span><span class="p">],</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<p>Once your schema is created, you will then create a model that will be utilized within your code.</p>
<div class="highlight"><pre><span></span><span class="c1">// mongoose.model(collection, schema), where collection is the</span>
<span class="c1">// name of the collection in your database.</span>
<span class="kd">const</span> <span class="nx">Attendee</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;attendee&#39;</span><span class="p">,</span> <span class="nx">attendeeSchema</span><span class="p">);</span>
</pre></div>
<p>This makes it easy to encapsulate the whole thing inside of a file for export in a <a href="node.html">node</a> project.</p>
<div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">attendeeSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
  <span class="p">...</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">Attendee</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Attendee&#39;</span><span class="p">,</span> <span class="nx">attendeeSchema</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Attendee</span><span class="p">;</span>
</pre></div>
<h2>Remote Database</h2>
<div class="highlight"><pre><span></span><span class="n">mongoose</span><span class="p">.</span><span class="k">connect</span><span class="p">(</span><span class="s1">&#39;mongodb://username:password@host:port&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="nl">useNewUrlParser</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="err">}</span><span class="p">);</span><span class="w"></span>
</pre></div>
<h2>Troubleshooting</h2>
<h3>Return Object</h3>
<p>The return of a query is not a plain Javascript object and will show weird behavior when trying to add to/remove from/modify it. If you want a plain Javascript object in return, you can use <code>.lean()</code> within your chain to cast it. </p>
<h2>References</h2>
<ol>
<li><a href="https://mongoosejs.com/" target="_blank">https://mongoosejs.com/</a></li>
<li><a href="https://stackoverflow.com/questions/33614229/how-to-use-mongo-mongoose-to-connect-to-a-remote-database" target="_blank">https://stackoverflow.com/questions/33614229/how-to-use-mongo-mongoose-to-connect-to-a-remote-database</a></li>
<li><a href="https://mongoosejs.com/docs/connections.html" target="_blank">https://mongoosejs.com/docs/connections.html</a></li>
</ol>

<p class="last-modified"><em>Last modified: 202108150035</em></p></article></main><footer><nav><p><a href="index.html">Sitemap</a></p><p><a href="fatfile.html">Fatfile (~602kb)</a></p></nav><div class="social"><p>Built using <a href="http://github.com/milofultz/swiki" target="_blank" rel="noopener noreferrer">{{SWIKI}}</a></p><p><a href="http://github.com/milofultz/" target="_blank" rel="noopener noreferrer">GitHub</a></p><p><a href="http://milofultz.com/" target="_blank" rel="noopener noreferrer">milofultz.com</a></p><p><a href="https://merveilles.town/@milofultz" target="_blank" rel="me noopener noreferrer">Mastodon</a></p></div></footer></body></html>