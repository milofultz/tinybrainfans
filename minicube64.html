<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="description" content="Minicube64 is a fantasy console style emulator based on 6502, with the intention of helping people learn how games were made for older systems."><title>Minicube64</title><link rel="stylesheet" href="./styles.css"></head><body>
<main id="main"><article id="content">            <h1 id="title">Minicube64</h1>
            <p><a href="https://aeriform.gitbook.io/minicube64/" target="_blank">Minicube64</a> is a fantasy console style emulator based on <a href="assembly-(6502).html">6502</a>, with the intention of helping people learn how games were made for older systems such as Atari 2600, NES or C64, but without many of the difficult hardware restrictions.</p>
<h2>Annotated Introduction</h2>
<p>The <a href="https://aeriform.gitbook.io/minicube64/" target="_blank">introduction page</a> is what I'm annotating below. Hopefully these notes will give more insight into what the assembly is doing in the console.</p>
<h3>Writing a New ROM</h3>
<p>On the page <a href="https://aeriform.gitbook.io/minicube64/new" target="_blank">&quot;Writing a New ROM&quot;</a>, there is a test program written in <a href="assembly-(6502).html">6502 assembly</a>. I figured a good way to learn what was going on was to annotate the whole thing and really grok it.</p>
<p>This is the contents of <code>test.s</code>:</p>
<pre><code class="language-assembly">include &quot;64cube.inc&quot;    ; Include the helper functinos for 64cube

ENUM $0                 ; Enumerate the following vars starting at $0000
  counter rBYTE 1        ; Set counter to type of byte with value of 1
ENDE                     ; End enumeration

  org $200              ; Specify the origin of the ROM program
  sei                    ; Set interrupt flag to 1
  ldx #$ff               ; Load 255 into X
  txs                   ; Transfer the contents of x to the stack
                        ;   pointer

  lda #$0               ; Load 0 into A
  sta VIDEO             ; Store A into VIDEO (location $100)

  _setw IRQ, VBLANK_IRQ  ; Store the address of IRQ at VBLANK_IRQ (in the
                        ;   include file)
  cli                   ; Clear interrupt flag

Infinite:                ; Set label for &#x27;Infinite&#x27; at this address
  jmp Infinite          ; Jump to the &#x27;Infinite&#x27; label, effectively
                        ;   creating an infinite loop

IRQ:                     ; Set label for &#x27;IRQ&#x27; at this address
  inc counter            ; Increment the value at &#x27;counter&#x27;
  rti                    ; Return to where the interrupt occurred

</code></pre>
<p>This is the relevant contents of <code>64cube.inc</code>:</p>
<pre><code class="language-assembly">...

; NOTE NOTE
; normal 6502 has irq vectors at $fffe
; we have them at $010e
NMI_IRQ  = $10c
VBLANK_IRQ = $10e

...

MACRO   _setw value,dest  ; create a macro named _setw with two params:
                          ;   &#x27;value&#x27;, and &#x27;dest&#x27;
  lda #&lt;value             ; load the high byte of value into register &#x27;a&#x27;
  sta dest                 ; store the value in register &#x27;a&#x27; at the address
                          ;   of destination
  lda #&gt;value             ; load the low byte of value into register &#x27;a&#x27;
  sta dest+1               ; store the value in register &#x27;a&#x27; at the address
                          ;   of destination + 1
ENDM                      ; signify the end of the macro
</code></pre>
<h3>Working With Pixels</h3>
<p>This is the changed contents of the above <code>test.s</code>:</p>
<pre><code class="language-assembly">...
  txs

  ; This will set the video buffer page in a 4k page in memory
  lda #$f                    ; Load high byte of page into &#x27;a&#x27;
                            ;   register
  sta VIDEO                 ; Store value in &#x27;a&#x27; register at &#x27;VIDEO&#x27;

  ; This will create a pixel of color #64 at pixel address $f820
  lda #$64                   ; Load decimal value 64 into &#x27;a&#x27;
                            ;   register
  ;sta $f820                ; Store value in &#x27;a&#x27; register at $f820
  sta $f000 + 32 + 32 * 64  ; Same as above but with MATH

  _setw IRQ, VBLANK_IRQ
...
</code></pre>
<h2>Minicube 64 Syntax</h2>
<p>This is syntax that doesn't exist in 6502 but does here.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>org $NNN</code></td>
<td><code>NNN</code>: Number</td>
<td>Set program origin to <code>$0NNN</code></td>
</tr>
</tbody></table><h2>Video Reference</h2>
<h3>Video Address Locations</h3>
<p>These are assuming the video page is being held in the 4k <code>$f000</code> page.</p>
<table>
<thead>
<tr>
<th>Address</th>
<th>Position</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0xf000</code></td>
<td>Top Left</td>
</tr>
<tr>
<td><code>0xf03f</code></td>
<td>Top Right</td>
</tr>
<tr>
<td><code>0xf820</code></td>
<td>Middle</td>
</tr>
<tr>
<td><code>0xffc0</code></td>
<td>Bottom Left</td>
</tr>
<tr>
<td><code>0xffff</code></td>
<td>Bottom Right</td>
</tr>
</tbody></table><h2>References</h2>
<ol>
<li><a href="https://aeriform.gitbook.io/minicube64/" target="_blank">https://aeriform.gitbook.io/minicube64/</a></li>
<li><a href="https://itch.io/jam/minicubejam" target="_blank">https://itch.io/jam/minicubejam</a></li>
</ol>

<p class="last-modified"><em>Last modified: 202109122035</em></p></article></main><footer><nav><p><a href="index.html">Sitemap</a></p><p><a href="fatfile.html">Fatfile (~665kb)</a></p></nav><div class="social"><p>Built using <a href="http://github.com/milofultz/swiki" target="_blank" rel="noopener noreferrer">{{SWIKI}}</a></p><p><a href="http://github.com/milofultz/" target="_blank" rel="noopener noreferrer">GitHub</a></p><p><a href="http://milofultz.com/" target="_blank" rel="noopener noreferrer">milofultz.com</a></p><p><a href="https://merveilles.town/@milofultz" target="_blank" rel="me noopener noreferrer">Mastodon</a></p></div></footer></body></html>