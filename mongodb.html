<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="description" content="MongoDB is a NoSQL database management system using documents similar to JSON."><title>MongoDB</title><link rel="stylesheet" href="./styles.css"></head><body>
<main id="main"><article id="content">            <h1 id="title">MongoDB</h1>
            <p>MongoDB is a <a href="nosql.html">NoSQL</a> <a href="database.html">database</a> management system using documents similar to <a href="json.html">JSON</a>.</p>
<h2>Getting Started</h2>
<p>This will start a new project using your local server and <a href="mongoose.html">mongoose</a> via <a href="node.html">node</a>.</p>
<h3>Local Machine</h3>
<p>Install MongoDB using <code>brew services install mongodb-community</code>. Once installed, you can start your local server using <code>brew services start mongodb-community</code> (Be sure to stop the server when completed with your work using <code>brew services stop mongodb-community</code>).</p>
<p>In the terminal, start the mongo shell: <code>mongo</code>.</p>
<h3>Database</h3>
<p>Creating a new database is done when a query is made.</p>
<h3>Node</h3>
<p>Create a new folder and initialize a new node project using <a href="npm.html">npm</a>: <code>npm init -y</code>. Then install <code>npm i mongoose</code>.</p>
<p>Create a new file called <code>server.js</code> and copy this into the contents:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">);</span>                <span class="c1">// import Mongoose</span>
<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">&#39;mongodb://localhost:27017/test&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="c1">// create connection to localhost</span>
  <span class="nx">useNewUrlParser</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> 
  <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">connection</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="s1">&#39;connection error:&#39;</span><span class="p">));</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>                            <span class="c1">// Inside here is where the action happens</span>
  <span class="c1">// Create schema for collection</span>
  <span class="kd">const</span> <span class="nx">kittySchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
    <span class="nx">name</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="nx">color</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
      <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">],</span>
    <span class="p">},</span>
  <span class="p">});</span>
  <span class="kd">const</span> <span class="nx">Cat</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Cat&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nb">String</span> <span class="p">});</span> 

  <span class="kd">const</span> <span class="nx">kitty</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cat</span><span class="p">({</span> 
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Zildjian&#39;</span><span class="p">,</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;orange&#39;</span>
  <span class="p">});</span>         <span class="c1">// Create a new document of Cat</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">kitty</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>                             <span class="c1">// &#39;Zildjian&#39;</span>
  <span class="nx">kitty</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;meow&#39;</span><span class="p">));</span>                   <span class="c1">// Save the new document in the Cat collection</span>
<span class="p">});</span>
</pre></div>
<p>In the terminal, run <code>node server.js</code>. This should log <code>&#x27;Zildjian&#x27;</code> along with <code>meow</code>.</p>
<h2>Indexes</h2>
<p>If your collection does not have an index, your query could take a very long time, as it will have to scan every single document within your collection and analyze it to see if it matches your query.</p>
<div class="highlight"><pre><span></span>// create an index in collectionName from highest score to lowest
db.collectionName.createIndex( { score: -1 } )
</pre></div>
<h2>Data Import</h2>
<p>Use <a href="https://docs.mongodb.com/database-tools/mongoimport/" target="_blank"><code>mongoimport</code></a> to bring in Extended <a href="json.html">JSON</a>, <a href="csv.html">CSV</a>, or <a href="tsv.html">TSV</a> files to your Mongo database. First, start up your database, and then use <a href="https://docs.mongodb.com/database-tools/mongoimport/" target="_blank"><code>mongoimport</code></a> in the command line:</p>
<div class="highlight"><pre><span></span><span class="c1">#             use the PetHotel db      use header line as field names</span>
$ mongoimport --db<span class="o">=</span>PetHotel --type<span class="o">=</span>csv --headerline --file<span class="o">=</span>pets.csv

<span class="c1"># If no header line is availabe:       list them out after the --fields option</span>
$ mongoimport --db<span class="o">=</span>PetHotel --type<span class="o">=</span>csv --fields<span class="o">=</span>_id,name,type --file<span class="o">=</span>pets.csv
</pre></div>
<h2>Data Modification</h2>
<p>If you need to modify data that already exists in a document due to a bad import or whatever, you can run a command like this in the mongo shell to change the values in place.</p>
<p>Let's assume a collection of dogs:</p>
<div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="p">...,</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Doggo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;goodBoy&quot;</span><span class="o">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="c1">// should be a boolean</span>
    <span class="s2">&quot;enemy&quot;</span><span class="o">:</span> <span class="s2">&quot;null&quot;</span><span class="p">,</span>   <span class="c1">// or could be &quot;mailman&quot; or other string</span>
  <span class="p">},</span>
  <span class="p">...</span>
<span class="p">]</span>
</pre></div>
<p>When completed, this will change all <code>goodboy</code> properties to a boolean and if <code>enemy</code> was imported with <code>null</code> as the string, it will convert it into an actual null value. The <code>bulkWrite</code> is done as it is <strong>much</strong> faster than sending individual requests.</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">requests</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">cursor</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">dogs</span><span class="p">.</span><span class="nx">find</span><span class="p">({});</span>

<span class="nx">cursor</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">item</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">requests</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> 
    <span class="s2">&quot;updateOne&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;filter&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">_id</span> <span class="p">},</span>
      <span class="s2">&quot;update&quot;</span><span class="o">:</span> <span class="p">{</span> 
        <span class="s2">&quot;$set&quot;</span><span class="o">:</span> <span class="p">{</span> 
          <span class="s2">&quot;goodBoy&quot;</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">goodboy</span><span class="p">),</span>
          <span class="s2">&quot;enemy&quot;</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">enemy</span> <span class="o">===</span> <span class="s1">&#39;null&#39;</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">enemy</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">requests</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mf">1000</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Execute per 1000 operations and re-init</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">dogs</span><span class="p">.</span><span class="nx">bulkWrite</span><span class="p">(</span><span class="nx">requests</span><span class="p">);</span>
    <span class="nx">requests</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">requests</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">dogs</span><span class="p">.</span><span class="nx">bulkWrite</span><span class="p">(</span><span class="nx">requests</span><span class="p">);</span>
  <span class="nx">requests</span> <span class="o">=</span> <span class="p">[];</span>
<span class="p">}</span>
</pre></div>
<h2>Syntax</h2>
<table>
<thead>
<tr>
<th>Command</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>show dbs</code></td>
<td>List all databases on the given server</td>
</tr>
<tr>
<td><code>use database_name</code></td>
<td>Enter into <code>database_name</code>, preparing to query.</td>
</tr>
<tr>
<td><code>db.dropDatabase()</code></td>
<td>Delete the selected database</td>
</tr>
<tr>
<td><code>show collections</code> / <code>show tables</code></td>
<td>List all collections/tables in the selected database.</td>
</tr>
<tr>
<td><code>db.collection_name.find()</code></td>
<td>Return all documents in collection <code>collection_name</code>.</td>
</tr>
<tr>
<td><code>db.people.find({name: &#x27;John&#x27;})</code></td>
<td>Return all documents in <code>people</code> whose name is John.</td>
</tr>
<tr>
<td><code>db.people.insert({name: &#x27;John&#x27;, age: 40})</code></td>
<td>Create a document in <code>people</code> (note: if a new collection is selected via <code>use</code>, this will create the new collection)</td>
</tr>
</tbody></table><h2>References</h2>
<h3>Mongo</h3>
<ol>
<li><a href="https://www.mongodb.com/basics/examples" target="_blank">https://www.mongodb.com/basics/examples</a></li>
<li><a href="https://www.mongodb.com/basics/create-database" target="_blank">https://www.mongodb.com/basics/create-database</a></li>
<li><a href="https://docs.mongodb.com/manual/core/databases-and-collections/" target="_blank">https://docs.mongodb.com/manual/core/databases-and-collections/</a></li>
<li><a href="https://docs.mongodb.com/manual/core/aggregation-pipeline/" target="_blank">https://docs.mongodb.com/manual/core/aggregation-pipeline/</a></li>
<li><a href="https://database.guide/import-a-csv-file-into-mongodb-with-mongoimport/" target="_blank">https://database.guide/import-a-csv-file-into-mongodb-with-mongoimport/</a></li>
<li><a href="https://docs.mongodb.com/manual/indexes/" target="_blank">https://docs.mongodb.com/manual/indexes/</a></li>
<li><a href="https://stackoverflow.com/questions/37718005/change-document-value-from-string-to-objectid-using-update-query" target="_blank">https://stackoverflow.com/questions/37718005/change-document-value-from-string-to-objectid-using-update-query</a></li>
<li><a href="https://www.mongodb.com/developer/how-to/SQL-to-Aggregation-Pipeline/" target="_blank">https://www.mongodb.com/developer/how-to/SQL-to-Aggregation-Pipeline/</a></li>
</ol>
<section id="backlinks"><h2>Backlinks:</h2><ul><li><a href="mongoose-(javascript).html">Mongoose (Javascript)</a></li></ul></section>
<p class="last-modified"><em>Last modified: 202108090238</em></p></article></main><footer><nav><p><a href="index.html">Sitemap</a></p><p><a href="fatfile.html">Fatfile (~500k)</a></p></nav><div class="social"><p>Built using <a href="http://github.com/milofultz/swiki" target="_blank" rel="noopener noreferrer">{{SWIKI}}</a></p><p><a href="http://github.com/milofultz/" target="_blank" rel="noopener noreferrer">GitHub</a></p><p><a href="http://milofultz.com/" target="_blank" rel="noopener noreferrer">milofultz.com</a></p><p><a href="https://merveilles.town/@milofultz" target="_blank" rel="me noopener noreferrer">Mastodon</a></p></div></footer></body></html>