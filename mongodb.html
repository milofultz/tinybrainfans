<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="description" content="MongoDB is a NoSQL database management system based on Javascript using documents similar to JSON."><title>MongoDB</title><link rel="stylesheet" href="./styles.css"></head><body>
<main id="main"><article id="content">            <h1 id="title">MongoDB</h1>
            <p>MongoDB is a <a href="nosql.html">NoSQL</a> <a href="database.html">database</a> management system based on <a href="javascript.html">Javascript</a> using documents similar to <a href="json.html">JSON</a>.</p>
<h2>Getting Started</h2>
<p>This will start a new project using your local server and <a href="mongoose.html">mongoose</a> via <a href="node.html">node</a>.</p>
<h3>Local Machine</h3>
<p>Install MongoDB using <code>brew services install mongodb-community</code>. Once installed, you can start your local server using <code>brew services start mongodb-community</code> (Be sure to stop the server when completed with your work using <code>brew services stop mongodb-community</code>).</p>
<p>In the terminal, start the mongo shell: <code>mongo</code>.</p>
<h3>Database</h3>
<p>Creating a new database is done when a query is made.</p>
<h3>Node</h3>
<p>Create a new folder and initialize a new node project using <a href="npm.html">npm</a>: <code>npm init -y</code>. Then install <code>npm i mongoose</code>.</p>
<p>Create a new file called <code>server.js</code> and copy this into the contents:</p>
<div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongoose&#39;</span><span class="p">);</span>                <span class="c1">// import Mongoose</span>
<span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">&#39;mongodb://localhost:27017/test&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="c1">// create connection to localhost</span>
  <span class="nx">useNewUrlParser</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> 
  <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">connection</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">console</span><span class="p">,</span> <span class="s1">&#39;connection error:&#39;</span><span class="p">));</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>                            <span class="c1">// Inside here is where the action happens</span>
  <span class="c1">// Create schema for collection</span>
  <span class="kd">const</span> <span class="nx">kittySchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">({</span>
    <span class="nx">name</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="nx">color</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
      <span class="kr">enum</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">],</span>
    <span class="p">},</span>
  <span class="p">});</span>
  <span class="kd">const</span> <span class="nx">Cat</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">&#39;Cat&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="nb">String</span> <span class="p">});</span> 

  <span class="kd">const</span> <span class="nx">kitty</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cat</span><span class="p">({</span> 
    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Zildjian&#39;</span><span class="p">,</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;orange&#39;</span>
  <span class="p">});</span>         <span class="c1">// Create a new document of Cat</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">kitty</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>                             <span class="c1">// &#39;Zildjian&#39;</span>
  <span class="nx">kitty</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;meow&#39;</span><span class="p">));</span>                   <span class="c1">// Save the new document in the Cat collection</span>
<span class="p">});</span>
</pre></div>
<p>In the terminal, run <code>node server.js</code>. This should log <code>&#x27;Zildjian&#x27;</code> along with <code>meow</code>.</p>
<h2>Indexes</h2>
<p>If your collection does not have an index, your query could take a very long time, as it will have to scan every single document within your collection and analyze it to see if it matches your query.</p>
<div class="highlight"><pre><span></span>// create an index in collectionName from highest score to lowest
db.collectionName.createIndex( { score: -1 } )
</pre></div>
<h2>Import and Export</h2>
<h3><a href="https://docs.mongodb.com/database-tools/mongoexport" target="_blank"><code>mongoexport</code></a>: Export <a href="json.html">JSON</a> or <a href="csv.html">CSV</a></h3>
<div class="highlight"><pre><span></span>$ mongoexport --db<span class="o">=</span>dbName --collection<span class="o">=</span>collectionName --out<span class="o">=</span>filename.json
</pre></div>
<p>When you export in CSV format, you must specify the fields in the documents to export.</p>
<div class="highlight"><pre><span></span><span class="c1"># for CSV etc.</span>
$ mongoexport --db<span class="o">=</span>dbName --collection<span class="o">=</span>collectionName --fields<span class="o">=</span>name,address --out<span class="o">=</span>filename.json
</pre></div>
<h3><a href="https://docs.mongodb.com/database-tools/mongoimport/" target="_blank"><code>mongoimport</code></a>: Import <a href="json.html">JSON</a>, <a href="csv.html">CSV</a>, or <a href="tsv.html">TSV</a></h3>
<p>Use <a href="https://docs.mongodb.com/database-tools/mongoimport/" target="_blank"><code>mongoimport</code></a> to bring in Extended <a href="json.html">JSON</a>, <a href="csv.html">CSV</a>, or <a href="tsv.html">TSV</a> files to your Mongo database. First, start up your database, and then use <a href="https://docs.mongodb.com/database-tools/mongoimport/" target="_blank"><code>mongoimport</code></a> in the command line:</p>
<div class="highlight"><pre><span></span><span class="c1">#             use the PetHotel db      use header line as field names</span>
$ mongoimport --db<span class="o">=</span>PetHotel --type<span class="o">=</span>csv --headerline --file<span class="o">=</span>pets.csv

<span class="c1"># If no header line is availabe:       list them out after the --fields option</span>
$ mongoimport --db<span class="o">=</span>PetHotel --type<span class="o">=</span>csv --fields<span class="o">=</span>_id,name,type --file<span class="o">=</span>pets.csv
</pre></div>
<h4>Types</h4>
<p>You can specify the <a href="https://docs.mongodb.com/database-tools/mongoimport/#std-option-mongoimport.--columnsHaveTypes" target="_blank">types</a> of the columns within the header line of your CSV.</p>
<div class="highlight"><pre><span></span>id.int32(),summary.string(),recommend.boolean(),helpfulness.int32()
1,&quot;This product was great!&quot;,true,8
</pre></div>
<div class="highlight"><pre><span></span>$ mongoimport --db<span class="o">=</span>PetHotel --type<span class="o">=</span>csv --headerline --columnsHaveTypes --file<span class="o">=</span>pets.csv
</pre></div>
<h4>Null Values</h4>
<p>If you have null values in your CSV, you can remove these <code>null</code> values between two commas (or after one if at the end of a line) and tell mongoimport to <code>--ignoreBlanks</code>. This won't import null values, but when interacting with your database, you can use the <a href="https://docs.mongodb.com/manual/reference/operator/query/exists/#mongodb-query-op.-exists" target="_blank"><code>$exists</code></a> query operator to query for them and <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/ifNull/#mongodb-expression-exp.-ifNull" target="_blank"><code>$ifNull</code> </a> to cast missing fields as <code>null</code> in an aggregation pipeline.</p>
<p>In the below example, the summary is null, but we still want it to accept strings.</p>
<div class="highlight"><pre><span></span>id.int32(),summary.string(),recommend.boolean(),helpfulness.int32()
1,null,true,8
</pre></div>
<p>If we were to import this as is, we would end up with a summary field containing an empty string. After replacing the <code>,null,</code> with <code>,,</code> and using <code>--ignoreBlanks</code> on import, this field ends up missing, which is the desired behavior. </p>
<p>To query for fields that have a missing of <code>null</code> field:</p>
<div class="highlight"><pre><span></span>&gt; db.collection_name.find({ summary: { $exists: false }})
</pre></div>
<p>And to get the field back with a <code>null</code> value in the place of that missing field:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">db</span><span class="p">.</span><span class="n">collection_name</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
<span class="p">...</span> <span class="c1">// match document with id of 1</span>
<span class="p">...</span> <span class="p">{</span> <span class="n">$match</span><span class="o">:</span> <span class="p">{</span> <span class="nl">id:</span> <span class="mh">1</span> <span class="p">}},</span>
<span class="p">...</span> <span class="c1">// show all fields and cast summary to null if missing</span>
<span class="p">...</span> <span class="p">{</span> <span class="n">$project</span><span class="o">:</span> <span class="p">{</span>
<span class="p">...</span>   <span class="nl">_id:</span> <span class="mh">0</span><span class="p">,</span>
<span class="p">...</span>   <span class="nl">id:</span> <span class="mh">1</span><span class="p">,</span>
<span class="p">...</span>   <span class="nl">summary:</span> <span class="p">{</span> <span class="n">$ifNull</span><span class="o">:</span> <span class="p">[</span> <span class="p">&#39;</span><span class="n">$summary</span><span class="p">&#39;,</span> <span class="n">null</span> <span class="p">]},</span>
<span class="p">...</span>   <span class="nl">recommend:</span> <span class="mh">1</span><span class="p">,</span>
<span class="p">...</span>   <span class="nl">helpfulness:</span> <span class="mh">1</span>
<span class="p">...</span> <span class="p">}}</span>
<span class="p">...</span> <span class="p">]);</span>
</pre></div>
<h3><a href="https://docs.mongodb.com/database-tools/mongodump/" target="_blank"><code>mongodump</code></a>: Export BSON (native format)</h3>
<p>To export a collection or database from a mongo database, use <a href="https://docs.mongodb.com/database-tools/mongodump/" target="_blank"><code>mongodump</code></a>.</p>
<div class="highlight"><pre><span></span>$ mongodump --db<span class="o">=</span>dbName --collection<span class="o">=</span>collectionName --out<span class="o">=</span>path/for/output
</pre></div>
<h3><a href="https://docs.mongodb.com/database-tools/mongorestore/" target="_blank"><code>mongorestore</code></a>: Import BSON (native format)</h3>
<p>To import a collection or database from a dumped mongo database, use <a href="https://docs.mongodb.com/database-tools/mongorestore/" target="_blank"><code>mongorestore</code></a>.</p>
<div class="highlight"><pre><span></span>$ mongorestore -d dbName ./dump/path
</pre></div>
<h2>Clone Database</h2>
<p>You can clone a database on the same server using the following command:</p>
<div class="highlight"><pre><span></span>$ mongodump --archive --db<span class="o">=</span>dbName <span class="p">|</span> mongorestore --archive  --nsFrom<span class="o">=</span><span class="s1">&#39;dbName.*&#39;</span> --nsTo<span class="o">=</span><span class="s1">&#39;newDbName.*&#39;</span>
</pre></div>
<h2>Data Modification</h2>
<p>If you need to modify data that already exists in a document due to a bad import or whatever, you can run a command like this in the mongo shell to change the values in place.</p>
<p>Let's assume a collection of dogs:</p>
<div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="p">...,</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Doggo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;goodBoy&quot;</span><span class="o">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="c1">// should be a boolean</span>
    <span class="s2">&quot;enemy&quot;</span><span class="o">:</span> <span class="s2">&quot;null&quot;</span><span class="p">,</span>   <span class="c1">// or could be &quot;mailman&quot; or other string</span>
  <span class="p">},</span>
  <span class="p">...</span>
<span class="p">]</span>
</pre></div>
<p>When completed, this will change all <code>goodboy</code> properties to a boolean and if <code>enemy</code> was imported with <code>null</code> as the string, it will convert it into an actual null value. The <code>bulkWrite</code> is done as it is <strong>much</strong> faster than sending individual requests.</p>
<div class="highlight"><pre><span></span><span class="k">var</span> <span class="n">requests</span> <span class="o">=</span> <span class="p">[];</span>
<span class="k">var</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">dogs</span><span class="o">.</span><span class="n">find</span><span class="p">({});</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">forEach</span><span class="p">(</span><span class="n">item</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="n">requests</span><span class="o">.</span><span class="n">push</span><span class="p">({</span> 
    <span class="s2">&quot;updateOne&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">_id</span> <span class="p">},</span>
      <span class="s2">&quot;update&quot;</span><span class="p">:</span> <span class="p">{</span> 
        <span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span> 
          <span class="s2">&quot;goodBoy&quot;</span><span class="p">:</span> <span class="n">Boolean</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">goodboy</span><span class="p">),</span>
          <span class="s2">&quot;enemy&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">enemy</span> <span class="o">===</span> <span class="s1">&#39;null&#39;</span> <span class="err">?</span> <span class="nb nb-Type">null</span> <span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">enemy</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">length</span> <span class="o">===</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">Execute</span> <span class="n">per</span> <span class="mi">1000</span> <span class="n">operations</span> <span class="ow">and</span> <span class="n">re</span><span class="o">-</span><span class="n">init</span>
    <span class="n">db</span><span class="o">.</span><span class="n">dogs</span><span class="o">.</span><span class="n">bulkWrite</span><span class="p">(</span><span class="n">requests</span><span class="p">);</span>
    <span class="n">requests</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">db</span><span class="o">.</span><span class="n">dogs</span><span class="o">.</span><span class="n">bulkWrite</span><span class="p">(</span><span class="n">requests</span><span class="p">);</span>
  <span class="n">requests</span> <span class="o">=</span> <span class="p">[];</span>
<span class="p">}</span>
</pre></div>
<h2>Syntax</h2>
<table>
<thead>
<tr>
<th>Command</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>show dbs</code></td>
<td>List all databases on the given server</td>
</tr>
<tr>
<td><code>use database_name</code></td>
<td>Enter into <code>database_name</code>, preparing to query.</td>
</tr>
<tr>
<td><code>db.dropDatabase()</code></td>
<td>Delete the selected database</td>
</tr>
<tr>
<td><code>show collections</code> / <code>show tables</code></td>
<td>List all collections/tables in the selected database.</td>
</tr>
<tr>
<td><code>db.collection_name.find()</code></td>
<td>Return all documents in collection <code>collection_name</code>.</td>
</tr>
<tr>
<td><code>db.collection_name.find({name: &#x27;John&#x27;})</code></td>
<td>Return all documents in <code>collection_name</code> whose name is John.</td>
</tr>
<tr>
<td><code>db.collection_name.insert({name: &#x27;John&#x27;, age: 40})</code></td>
<td>Create a document in <code>collection_name</code> (note: if a new collection is selected via <code>use</code>, this will create the new collection)</td>
</tr>
<tr>
<td><code>db.collection_name.renameCollection(&#x27;newName&#x27;, dropOld)</code></td>
<td>Rename <code>collection_name</code> to <code>newName</code> and if drop old table if <code>dropOld</code> is true.</td>
</tr>
</tbody></table><h2>References</h2>
<ul>
<li><a href="https://www.mongodb.com/basics/examples" target="_blank">https://www.mongodb.com/basics/examples</a></li>
<li><a href="https://www.mongodb.com/basics/create-database" target="_blank">https://www.mongodb.com/basics/create-database</a></li>
<li><a href="https://docs.mongodb.com/manual/core/databases-and-collections/" target="_blank">https://docs.mongodb.com/manual/core/databases-and-collections/</a></li>
<li><a href="https://docs.mongodb.com/manual/core/aggregation-pipeline/" target="_blank">https://docs.mongodb.com/manual/core/aggregation-pipeline/</a></li>
<li><a href="https://database.guide/import-a-csv-file-into-mongodb-with-mongoimport/" target="_blank">https://database.guide/import-a-csv-file-into-mongodb-with-mongoimport/</a></li>
<li><a href="https://docs.mongodb.com/manual/indexes/" target="_blank">https://docs.mongodb.com/manual/indexes/</a></li>
<li><a href="https://stackoverflow.com/questions/37718005/change-document-value-from-string-to-objectid-using-update-query" target="_blank">https://stackoverflow.com/questions/37718005/change-document-value-from-string-to-objectid-using-update-query</a></li>
<li><a href="https://www.mongodb.com/developer/how-to/SQL-to-Aggregation-Pipeline/" target="_blank">https://www.mongodb.com/developer/how-to/SQL-to-Aggregation-Pipeline/</a></li>
<li><a href="https://docs.mongodb.com/database-tools/mongoimport/#std-label-example-csv-import-types" target="_blank">https://docs.mongodb.com/database-tools/mongoimport/#std-label-example-csv-import-types</a></li>
<li><a href="https://docs.mongodb.com/database-tools/mongodump/" target="_blank">https://docs.mongodb.com/database-tools/mongodump/</a></li>
<li><a href="https://stackoverflow.com/questions/21233290/mongorestore-error-dont-know-what-to-do-with-the-dump-file" target="_blank">https://stackoverflow.com/questions/21233290/mongorestore-error-dont-know-what-to-do-with-the-dump-file</a></li>
</ul>
<section id="backlinks"><h2>Backlinks:</h2><ul><li><a href="mongoose.html">Mongoose</a></li></ul></section>
<p class="last-modified"><em>Last modified: 202108200033</em></p></article></main><footer><nav><p><a href="index.html">Sitemap</a></p><p><a href="fatfile.html">Fatfile (~618kb)</a></p></nav><div class="social"><p>Built using <a href="http://github.com/milofultz/swiki" target="_blank" rel="noopener noreferrer">{{SWIKI}}</a></p><p><a href="http://github.com/milofultz/" target="_blank" rel="noopener noreferrer">GitHub</a></p><p><a href="http://milofultz.com/" target="_blank" rel="noopener noreferrer">milofultz.com</a></p><p><a href="https://merveilles.town/@milofultz" target="_blank" rel="me noopener noreferrer">Mastodon</a></p></div></footer></body></html>